<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>我的购物车-英雄联盟道聚城购物车</title>
    <link rel="stylesheet" href="css/car.css"/>
    <link rel="stylesheet" href="css/public.css"/>
</head>
<body>
        <header>
                <div class="margin">
                    <p id="headzuo">
                        <em></em>
                        <span>手机版</span>
                        <span>|</span>
                        <span>Q币充值</span>
                    </p>
                    <p id="headyou">
                            <span class="haha">您还未登录，请<a href="log.html" class="log">登录</a></span>
                        <span>|</span>
                        <span>我的订单</span>
                        <span>|</span>
                        <span>个人中心</span>
                        <span>|</span>
                        <span>帮助中心</span>
                        <span>|</span>
                        <span>游戏导航   ∨</span>
                    </p>
                </div>
        </header>
        <nav>
        <div class="margin">
        <div id="nt">
                <img src="img/nt-l.png" class="nt-l"/>
                <div id="sou">
                    <input type="text" id="sou-c" placeholder="输入道具进行搜索"/>
                    <inpu type="button" id="sou-r"/>
                </div>
                <img src="img/nt-r.png" class="nt-r"/>
        </div>
        
        <div id="nb">
            <ul>
                <li><a href="index.html">首页</a></li>
                <li><a href="list.html">商品列表</a></li>
                <li><a href="">活动专区</a></li>
                <li><a href="">限时折扣</a></li>
                <li><a href="">聚豆乐园</a></li>
                <li><a href="">周边商城</a></li>
                <li><a href="">个人中心</a></li>
                <li class="car"><s></s><a href="car.html">购物车</a></li>
            </ul>
        </div>
        
        </div>
        </nav>
        

<div id="banner">
    <div class="margin">
            <p class="ppp">
                    您现在的位置：<a href="">英雄联盟</a>  >  <a href="">购物车</a>
                </p>
            
    <div id="pbox">
        <h3>
            商品信息
        </h3>
        <table border="0" cellspacing="0" width="1150" align="center">
                <thead>
                    <tr>
                        <th><input type="checkbox" class="all"/>全选</th>
                        <th>商品</th>
                        <th>名字</th>
                        <th>类型</th>
                        <th>单价</th>
                        <th>期限</th>
                        <th>数量</th>
                        <th>小计</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="9" class="kong">购物车为空...<a href="index.html">去购物</a></td>
                    </tr>
                    <!-- <tr index="">
                        <td><input class="ck" type="checkbox"/></td>
                        <td><img src=""/></td>
                        <td></td>
                        <td>皮肤</td>
                        <td>Q币</td>
                        <td>永久</td>
                        <td><input class="num" type="number" min=1/></td>
                        <td class="pr"></td>
                        <td class="delete">删除</td>
                    </tr> -->
                </tbody>
                <tfoot align="center">
                        <tr height="80px">
                            <td colspan="6">
                            <td class="number">共0个</td>
                            <td class="price">实付款:<a>￥0.00</a></td>
                            <td class="fu">提交订单</td>
                        </tr>
                </tfoot>
            </table>

        </div>
         </div>
</div>


<div id="foot">
        <div class="margin">
            <ul>
                <li class="fl1">
                    <div class="fll">
                    <s></s>
                    </div>
                    <div class="flr">
                    <p class="fp1">我是新手</p>
                    <p>什么是道聚城</p>
                    <p>如何购买</p>
                    <p>如何赠送</p>
                    <p>如何获取聚豆</p>
                    </div>
                </li>
                <li class="fl2">
                    <div class="fll">
                    <s></s>
                    </div>
                    <div class="flr">
                    <p class="fp1">个人中心</p>
                    <p>发货时间</p>
                    <p>如何领取</p>
                    <p>补发规则</p>
                    <p>Vip价定义</p>
                    <p>道具状态定义</p>
                    </div>
                </li>
                <li class="fl3">
                    <div class="fll">
                    <s></s>
                    </div>
                    <div class="flr">
                    <p class="fp1">支付方式</p>
                    <p>支付方式</p>
                    <p>购物点支付</p>
                    <p>如何充值</p>
                    </div>
                </li>
                <li class="fl4">
                    <div class="fll">
                    <s></s>
                    </div>
                    <div class="flr">
                    <p class="fp1">腾讯在线服务</p>
                    <p>腾讯官方在线服务</p>
                    </div>
                </li>
                <li class="fl5">
                    <div class="f5-l">
                        <img src="https://js01.daoju.qq.com/common/images/mall/zsdjc.png"/>
                        <p>掌上道聚城</p>
                    </div>
                    <div class="f5-r">
                            <img src="https://js01.daoju.qq.com/common/images/mall/wechatdjc.png"/>
                            <p>道聚城公众号</p>
                    </div>
                </li>
            </ul>
            <div class="ftxt">
                <p>腾讯互动娱乐 | 服务条款| 腾讯游戏隐私保护指引| 腾讯游戏儿童隐私保护指引| 广告服务 | 腾讯游戏招聘 | 腾讯游戏客服 | 游戏地图 | 成长守护平台 | 商务合作 | 网站导航</p>
                <p>COPYRIGHT © 1998 – 2019 TENCENT. ALL RIGHTS RESERVED.</p>
                <p>腾讯公司 版权所有</p>
            </div>
        </div>
    </div>
</body>
<script src="lib/jquery.js"></script>
<script src="lib/jj.json"></script>
<script src="lib/ajax.js"></script>
<script src="lib/cookie.js"></script>
<script>

class log{
        constructor(){
            this.log=document.querySelector(".haha")
            this.msg=getCookie("userMsg")?JSON.parse(getCookie("userMsg")):[]
            this.bian=document.querySelector(".bian");
            
            this.load();
        }
        load(){

            for(var i=0;i<this.msg.length;i++){
                if(this.msg[i].onoff==1){
                    this.log.innerHTML=`
                    欢迎你  ${this.msg[i].user}<a  class="out">注销</a>`
                    this.out();
                }
            }
           
        }
        out(){
            this.out=document.querySelector('.out');
            this.out.onclick=()=>{
                for(var i=0;i<this.msg.length;i++){
                    this.msg[i].onoff=0;
                }
                setCookie("userMsg",JSON.stringify(this.msg));
                this.log.innerHTML=`
                您还未登录，请<a href="log.html" class="log">登录</a>`;
                
            }
        }  
    }
    new log();

    class che{
			constructor(){
				this.url="http://localhost:81/lib/jj.json";
				this.box=document.querySelector("tbody");
				this.tp=document.querySelector(".price");
				this.tn=document.querySelector(".number")
				this.dck=document.querySelector(".all")
				
				this.load();
				this.add();
				this.type=0;
			}
			add(){
				var that=this;
				this.box.addEventListener("click",function(eve){
					var e=eve||window.event;
					var target=e.target||e.srcElement;
					if(target.className=="delete"){
						that.id=target.parentNode.getAttribute("index");
						target.parentNode.firstElementChild.firstElementChild.checked=false;
						target.parentNode.remove();
						that.nextload()
						that.changeCookie(function(i){
							that.goods.splice(i,1);
							that.price();
							that.num();
						})
					}
				})
				this.box.addEventListener("input",function(eve){

					var e =eve||window.event;
					var target=e.target||e.srcElement;
					if(target.className=="num"){
						that.id=target.parentNode.parentNode.getAttribute("index");
						that.p=target.parentNode.previousElementSibling.previousElementSibling.innerHTML;
						that.n=target.value;
						target.parentNode.nextElementSibling.innerHTML=that.p*that.n;
						that.price();
						that.num();
						that.changeCookie(function(i){
						that.goods[i].num=target.value;
						console.log(that.goods)

						})
					}
				})
			}
			changeCookie(cb){
				for(var i=0;i<this.goods.length;i++){
					if(this.goods[i].id==this.id){
						 cb(i);
					break;
				}
				}
				setCookie("goods",JSON.stringify(this.goods))
			}

			load(){
				this.dck.checked=false;
				var that=this;
				var ppp=ajaxGet(this.url,function(res){
					that.res=JSON.parse(res);
					that.getcook();
				})
			}
			getcook(){
				this.goods=getCookie("goods")?JSON.parse(getCookie("goods")):[];
				this.display();
			}
			display(){
				var str3="";
				for(var i=0;i<this.res.length;i++){
					for(var j=0;j<this.goods.length;j++){
						if(this.res[i].num==this.goods[j].id){
							str3+=`<tr index="${this.res[i].num}">
                        <td><input class="ck" type="checkbox"/></td>
                        <td><img src="${this.res[i].ximg}"/></td>
                        <td>${this.res[i].name}</td>
                        <td>皮肤</td>
                        <td>${this.res[i].price}</td>
                        <td>永久</td>
                        <td><input type="number" class="num" min=1 value="${this.goods[j].num}"/></td>
                        <td class="pr">${this.res[i].price*this.goods[j].num}</td>
                        <td class="delete">删除</td>
                    </tr>`	}
					}
				}
				this.box.innerHTML=str3;
				this.nextload()
				this.checked();
			}
			nextload(){
				this.ack=document.querySelectorAll("tr .ck");
				this.apr=document.querySelectorAll(".pr");
				this.anum=document.querySelectorAll(".num");
			}
			checked(){
				this.dck.onclick=()=>{
					if(this.type==0){
						for(var i=0;i<this.ack.length;i++){
							this.ack[i].checked=true;
						}
						this.type=1;
					}else{
						for(var i=0;i<this.ack.length;i++){
							this.ack[i].checked=false;
						}
						this.type=0;
					}
					this.price();
					this.num();
				};
				this.ack.forEach((item,idx)=>{
					item.onclick=()=>{
					var onoff =true;
					for(var i=0;i<this.ack.length;i++){
						if(!this.ack[i].checked){
							onoff = false;
							break;
						}
					}
					if(onoff){
						this.dck.checked=true;
						this.type=1;
					}else{
						this.dck.checked=false;
						this.type=0;
					}
					
					this.price();
					this.num();
				}
				})
				
			}
			price(){
				var dp =0;
				for(var i=0;i<this.apr.length;i++){
					if(this.ack[i].checked){
						dp+=(this.apr[i].innerHTML)/1;
						// console.log(this.apr[i].innerHTML)
					}
				}
				
				this.tp.innerHTML="实付款:<a>￥"+dp+"</a>"
			}
			num(){
				var dn =0;
				for(var i=0;i<this.anum.length;i++){
					if(this.ack[i].checked){
						dn+=(this.anum[i].value)/1;
						// console.log(this.anum[i].value)
					}
				}
				this.tn.innerHTML="共"+dn+"个";
			}

		}
    new che;

</script>


</html>